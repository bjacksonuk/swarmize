= render :partial => "swarms/swarm_page_js"

= render :partial => "swarms/swarm_header"
- if @swarm.user == @current_user
  = render :partial => "swarms/swarm_description_open_close_logged_in"
- else
  = render :partial => "swarms/swarm_description_open_close"

%hr

- 
- if @swarm.closed? || @current_user
  - if @swarm.fields_of_type('pick_one')
    %h2 Graphs

    - @swarm.fields_of_type('pick_one').each_with_index do |field, i|
      :javascript
        $(document).ready(function() {
          $.getJSON('#{SwarmizeGraph.count_url(@swarm, field['field_name'].parameterize.underscore)}', function(data) {
            $("#graphs").append("<div class='graph-container' id='graph-container#{i+1}'></div>");
            $("#graph-container#{i+1}").append("<h3>#{field['field_name']}</h3>");
            $("#graph-container#{i+1}").append("<div class='epoch' id='graph#{i+1}'></div>");
            $('#graph#{i+1}').epoch({ type: 'pie', data: data });
          });
        });

    #graphs

    .clearfix

- if @swarm.closed? || @current_user
  %h2 
    Results
    = link_to "CSV", csv_swarm_path(@swarm), :class => "btn btn-default", :style => 'float: right'

  .clearfix

  - if @elasticsearch_error
    %p= @elasticsearch_error
  - else
    = render :partial => "swarms/swarm_results"
- else
  %h2 Results
  %p Results will appear here when the swarm is complete.

= render "swarms/open_swarm_modal"
= render "swarms/close_swarm_modal"
